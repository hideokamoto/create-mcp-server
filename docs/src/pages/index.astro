---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import githubData from '../data/github.json';
import sanitizeHtml from 'sanitize-html';

// Safely access releases array
const latestRelease = Array.isArray(githubData?.releases) && githubData.releases.length > 0
  ? githubData.releases[0]
  : null;

const dateFormatOptions = {
  year: 'numeric' as const,
  month: 'long' as const,
  day: 'numeric' as const
};

// Sanitize HTML helper
const sanitize = (html: string | undefined) => {
  if (!html) return '';
  return sanitizeHtml(html.replace(/\n/g, '<br>'), {
    allowedTags: ['br', 'p', 'strong', 'em', 'code', 'pre', 'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'a'],
    allowedAttributes: {
      'a': ['href', 'title', 'target']
    }
  });
};
---

<Layout
  title="create-mcp-tools - MCP Server Generator"
  description="A command line tool for quickly scaffolding new MCP (Model Context Protocol) servers"
  lang="en"
>
  <Header lang="en" />

  <section class="hero">
    <div class="container">
      {latestRelease && <div class="badge">{latestRelease.tag_name}</div>}
      <h1>create-mcp-tools</h1>
      <p>A command line tool for quickly scaffolding new MCP (Model Context Protocol) servers</p>
      <a href="#getting-started" class="btn">Get Started</a>
      <a href="https://github.com/hideokamoto/create-mcp-server" class="btn btn-secondary">View on GitHub</a>
    </div>
  </section>

  <section id="getting-started" class="section">
    <div class="container">
      <h2 class="section-title">Getting Started</h2>
      <p class="section-subtitle">
        Create a new MCP server project with just one command
      </p>

      <div class="code-block">
        <pre><span class="comment"># Create a new server in the "my-server" directory</span>
<span class="command">npm create mcp-tools my-server</span>

<span class="comment"># With options</span>
<span class="command">npm create mcp-tools my-server --name "My MCP Server" --description "A custom MCP server"</span></pre>
      </div>

      <div class="step-item">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>Create Project</h3>
          <p>Run the command above to create a new MCP server project</p>
        </div>
      </div>

      <div class="step-item">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>Install Dependencies</h3>
          <div class="code-block">
            <pre><span class="command">cd my-server</span>
<span class="command">npm install</span></pre>
          </div>
        </div>
      </div>

      <div class="step-item">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>Build & Run</h3>
          <div class="code-block">
            <pre><span class="comment"># Build once</span>
<span class="command">npm run build</span>

<span class="comment"># Or use watch mode during development</span>
<span class="command">npm run watch</span>

<span class="comment"># Optional: make it globally available</span>
<span class="command">npm link</span></pre>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="features" class="section steps">
    <div class="container">
      <h2 class="section-title">Key Features</h2>
      <p class="section-subtitle">
        Forked from the original with the latest MCP SDK and features
      </p>

      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">üöÄ</div>
          <h3>Latest MCP SDK</h3>
          <p>Uses MCP SDK v1.22.0, supporting the latest features and best practices</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">‚ú®</div>
          <h3>Modern API</h3>
          <p>Uses new API methods like registerTool, registerPrompt, and registerResource</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üîç</div>
          <h3>Type Safety</h3>
          <p>Strong type checking and input validation with TypeScript 5.7.2 and Zod</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üì¶</div>
          <h3>Ready to Use</h3>
          <p>Includes all necessary configurations to start development immediately</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üîÑ</div>
          <h3>Regular Updates</h3>
          <p>Regularly maintained following the latest MCP specifications and best practices</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üìù</div>
          <h3>Rich Templates</h3>
          <p>Provides templates with implementation examples for tools, prompts, and resources</p>
        </div>
      </div>
    </div>
  </section>

  <section id="migration" class="section">
    <div class="container">
      <h2 class="section-title">v1.0.0 - Breaking Changes</h2>
      <p class="section-subtitle">
        Important changes to support the latest MCP SDK v1.22.0
      </p>

      <div class="comparison">
        <h3>API Changes</h3>
        <div class="comparison-grid">
          <div class="old-api">
            <h4>‚ùå Old API (deprecated)</h4>
            <div class="code-block">
              <pre>server.tool(
  "create_note",
  &#123;
    title: z.string(),
    content: z.string()
  &#125;,
  async (&#123; title, content &#125;) => &#123;
    // ...
  &#125;
);</pre>
            </div>
          </div>

          <div class="new-api">
            <h4>‚úÖ New API (recommended)</h4>
            <div class="code-block">
              <pre>server.registerTool(
  "create_note",
  &#123;
    title: "Create Note",
    description: "Create a new note",
    inputSchema: &#123;
      title: z.string()
        .describe("The title"),
      content: z.string()
        .describe("The content")
    &#125;
  &#125;,
  async (&#123; title, content &#125;) => &#123;
    // ...
  &#125;
);</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="releases" class="section steps">
    <div class="container">
      <h2 class="section-title">Releases</h2>
      <p class="section-subtitle">
        Latest releases and updates
      </p>

      <div class="releases-list">
        {(Array.isArray(githubData?.releases) ? githubData.releases : []).slice(0, 5).map((release) => (
          <div class="release-item">
            <div class="release-header">
              <h3 class="release-title">{release.name || release.tag_name}</h3>
              <span class="release-date">
                {new Date(release.published_at).toLocaleDateString('en-US', dateFormatOptions)}
              </span>
            </div>
            <div class="release-body" set:html={sanitize(release.body)} />
            <a href={release.html_url} class="btn" style="margin-top: 15px; display: inline-block;">View on GitHub</a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>
        MIT License &copy; 2025 Hidetaka Okamoto<br>
        <a href="https://github.com/hideokamoto/create-mcp-server">GitHub</a> |
        <a href="https://www.npmjs.com/package/create-mcp-tools">npm</a> |
        <a href="https://github.com/hideokamoto/create-mcp-server/issues">Issues</a>
      </p>
      <p style="margin-top: 20px; opacity: 0.7;">
        Original project: <a href="https://www.npmjs.com/package/@modelcontextprotocol/create-server">@modelcontextprotocol/create-server</a>
      </p>
    </div>
  </footer>
</Layout>
